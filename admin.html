
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>إدارة المكتبة</title>
  <style>
    body { font-family: sans-serif; direction: rtl; padding: 2rem; background: #f5f5f5; }
    label { display: block; margin-top: 1rem; }
    input, select, textarea { width: 100%; padding: 0.5rem; }
    button { padding: 0.5rem 1rem; margin-top: 1rem; background: green; color: white; border: none; }
  </style>
  
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCGrL1YVZwM4vIgIPSZtnao_TGS_glf3aw",
    authDomain: "book-fa11d.firebaseapp.com",
    projectId: "book-fa11d",
    storageBucket: "book-fa11d.firebasestorage.app",
    messagingSenderId: "771215422411",
    appId: "1:771215422411:web:55723a39729e3621b3fc4e",
    measurementId: "G-EB5M3PMRWK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

</head>
<body>
  <h1>📚 لوحة الإدارة</h1>

  <form id="add-book-form">
    <label>عنوان الكتاب</label>
    <input id="book-title" required>

    <label>المؤلف</label>
    <input id="book-author" required>

    <label>الطبعة</label>
    <input id="book-edition">

    <label>عدد المجلدات</label>
    <input id="book-volumes">

    <label>القسم</label>
    <select id="book-category">
      <option value="غير مصنف">غير مصنف</option>
      <option value="قسم التفسير">قسم التفسير</option>
      <option value="قسم الحديث">قسم الحديث</option>
    </select>

    <label>نبذة عن الكتاب</label>
    <textarea id="book-description"></textarea>

    <label>صورة الغلاف (اختياري)</label>
    <input type="file" id="book-image">

    <button type="submit">➕ إضافة الكتاب</button>
  </form>

  <script>
    document.getElementById("add-book-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const title = document.getElementById("book-title").value.trim();
      const author = document.getElementById("book-author").value.trim();
      const edition = document.getElementById("book-edition").value.trim();
      const volumes = document.getElementById("book-volumes").value.trim();
      const category = document.getElementById("book-category").value.trim();
      const description = document.getElementById("book-description").value.trim();
      const imageFile = document.getElementById("book-image").files[0];

      let imageBase64 = "";

      if (imageFile) {
        try {
          imageBase64 = await readFileAsDataURL(imageFile);
        } catch (err) {
          return alert("❌ خطأ في قراءة صورة الغلاف: " + err.message);
        }
      }

      try {
        await db.collection("books").add({
          title,
          author,
          edition,
          volumes,
          category,
          description,
          image: imageBase64
        });
        alert("✅ تم حفظ الكتاب بنجاح");
        document.getElementById("add-book-form").reset();
      } catch (err) {
        alert("❌ فشل الحفظ في Firebase: " + err.message);
      }
    });

    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
