<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة مكتبة المسجد</title>
    <style>
        :root {
            --primary-color: #087f5b; --secondary-color: #b8860b; --background-color: #f8f9fa;
            --card-background-color: #ffffff; --text-color: #343a40; --border-color: #dee2e6;
            --danger-color: #d9480f; --danger-hover: #c9400a; --success-color: var(--primary-color);
            --success-hover: #077251; --info-color: #1c7ed6; --info-hover: #1971c2;
        }
        @font-face {
            font-family: 'Tajawal';
            src: url('https://fonts.gstatic.com/s/tajawal/v9/Iura6YBj_oCad4k1nzSBC45I.woff2') format('woff2');
            font-weight: 400; font-style: normal; font-display: swap;
        }
        body {
            font-family: 'Tajawal', sans-serif; background-color: var(--background-color); color: var(--text-color);
            margin: 0; padding: 25px;
        }
        .container {
            width: 100%; max-width: 900px; margin: auto; background: var(--card-background-color);
            padding: 30px 40px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary-color);
        }
        h1, h2 {
            color: var(--primary-color); text-align: center; border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px; margin-bottom: 25px;
        }
        h2 { font-size: 1.5em; margin-bottom: 20px; }
        
        #login-screen { text-align: center; max-width: 400px; margin: 10vh auto; }
        #login-form input {
            padding: 12px 15px; font-size: 1.1em; width: 100%; border: 1px solid var(--border-color);
            border-radius: 8px; margin-bottom: 15px; font-family: inherit; box-sizing: border-box; transition: all 0.3s;
        }
        #login-form input:focus { outline: none; border-color: var(--secondary-color); box-shadow: 0 0 8px rgba(184, 134, 11, 0.2); }
        
        #admin-panel { display: none; }
        #initialization-section { margin-bottom: 20px; text-align: center; }
        .form-section { background: #f8f9fa; padding: 25px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 30px; }
        .form-section h2 { margin-top: 0; padding-bottom: 10px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-grid .full-width { grid-column: 1 / -1; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.95em; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box;
            font-family: inherit; font-size: 1em; background-color: #fff; transition: all 0.3s;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: var(--secondary-color); box-shadow: 0 0 8px rgba(184, 134, 11, 0.2);
        }

        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1.05em; font-weight: bold; transition: all 0.2s; font-family: inherit; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .btn-primary { background-color: var(--info-color); color: white; } .btn-primary:hover { background-color: var(--info-hover); }
        .btn-success { background-color: var(--success-color); color: white; } .btn-success:hover { background-color: var(--success-hover); }
        .btn-danger { background-color: var(--danger-color); color: white; } .btn-danger:hover { background-color: var(--danger-hover); }
        .action-buttons { display: flex; gap: 8px; }
        .action-buttons .btn { padding: 6px 12px; font-size: 0.85em; }

        .category-manage-section details { border-bottom: 1px solid #eee; margin-bottom: 10px; }
        .category-manage-section summary { 
            padding: 12px; font-size: 1.2em; font-weight: bold; color: var(--primary-color); cursor: pointer;
            list-style: none; /* For Webkit to hide marker with ::before */
            position: relative; outline: none; transition: background-color 0.2s;
        }
        .category-manage-section summary:hover { background-color: #f0f0f0; }
        .category-manage-section details[open] > summary { color: var(--secondary-color); }
        .category-manage-section summary::-webkit-details-marker { display: none; }
        .category-manage-section summary::before {
            content: '＋'; font-size: 0.8em; font-weight: bold; color: var(--primary-color);
            position: absolute; left: 10px; top: 50%; transform: translateY(-50%) rotate(0deg); transition: transform 0.3s ease;
        }
        .category-manage-section details[open] > summary::before { content: '−'; transform: translateY(-50%) rotate(180deg); }

        .books-listing-admin { padding: 10px 10px 10px 35px; } /* Indent books under summary */
        .book-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
        .book-list-item:last-child { border-bottom: none; }
        .book-details { flex-grow: 1; padding-left: 15px; } .book-details .title { font-weight: bold; color: var(--text-color); }
        .book-details .author { font-size: 0.9em; color: #6c757d; }

        #admin-search-input { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 6px; box-sizing: border-box; }


        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1050; justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 30px; border-radius: 10px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-close-btn { font-size: 2em; line-height: 1; color: #888; cursor: pointer; background: none; border: none; }
        #image-preview { max-width: 150px; height: auto; display: block; margin: 10px auto; border: 1px solid #ccc; padding: 5px; }

        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            .container { padding: 15px; }
            .category-manage-section summary::before { left: 5px; }
            .books-listing-admin { padding: 10px 10px 10px 25px; }
        }
    </style>
</head>
<body>

    <div class="container" id="main-container">
        <div id="login-screen">
            <h1>لوحة تحكم المكتبة</h1>
            <p>الرجاء إدخال كلمة المرور للوصول.</p>
            <form id="login-form">
                <input type="password" id="password" placeholder="كلمة المرور" required>
                <br>
                <button type="submit" class="btn btn-primary">دخول</button>
            </form>
            <p id="login-error" style="color: var(--danger-color); display: none;">كلمة المرور غير صحيحة.</p>
        </div>

        <div id="admin-panel">
            <h1>إدارة الكتب والأقسام</h1>
            
            <div id="initialization-section" style="display: none;">
                <p>قاعدة البيانات فارغة. هل تريد تهيئتها بالبيانات الافتراضية؟</p>
                <button id="initialize-db-btn" class="btn btn-success">تهيئة قاعدة البيانات بالكتب الافتراضية</button>
            </div>

            <div class="form-section">
                <h2>إضافة قسم جديد</h2>
                <form id="add-category-form">
                    <div class="form-group full-width">
                        <label for="new-category-name">اسم القسم الجديد</label>
                        <input type="text" id="new-category-name" required>
                    </div>
                    <button type="submit" class="btn btn-success" style="margin-top: 10px;">إضافة القسم</button>
                </form>
            </div>

            <div class="form-section">
                <h2>إضافة كتاب جديد</h2>
                <form id="add-book-form">
                    <div class="form-grid">
                        <div class="form-group full-width"> <label for="book-title">عنوان الكتاب</label> <input type="text" id="book-title" required> </div>
                        <div class="form-group"> <label for="book-author">المؤلف</label> <input type="text" id="book-author" required> </div>
                        <div class="form-group"> <label for="book-edition">الطبعة</label> <input type="text" id="book-edition" required> </div>
                        <div class="form-group"> <label for="book-volumes">عدد المجلدات</label> <input type="text" id="book-volumes" value="1" required> </div>
                        <div class="form-group"> <label for="book-category">القسم</label> <select id="book-category" required></select> </div>
                        <div class="form-group full-width"> <label for="book-description">نبذة عن الكتاب</label> <textarea id="book-description"></textarea> </div>
                        <div class="form-group full-width"> <label for="book-image">صورة الغلاف (اختياري)</label> <input type="file" id="book-image" accept="image/*"> </div>
                    </div>
                    <button type="submit" class="btn btn-success" style="margin-top: 20px;">إضافة الكتاب</button>
                </form>
            </div>

            <div class="form-section">
                <h2>قائمة الكتب الحالية</h2>
                <input type="search" id="admin-search-input" placeholder="ابحث في الكتب (بالعنوان أو المؤلف)...">
                <div id="manage-book-list"><p>جارٍ تحميل الكتب...</p></div>
            </div>
             <a href="index.html" target="_blank" style="text-align: center; display:block; margin-top: 20px; color: var(--secondary-color); font-weight: bold;">عرض صفحة المكتبة الرئيسية</a>
        </div>
    </div>

    <div id="edit-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تعديل الكتاب</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <form id="edit-book-form">
                <input type="hidden" id="edit-book-original-category-id">
                <input type="hidden" id="edit-book-index"> <!-- This will be the original index in the category's books array -->
                <div class="form-grid">
                    <div class="form-group full-width"> <label for="edit-book-title">عنوان الكتاب</label> <input type="text" id="edit-book-title" required> </div>
                    <div class="form-group"> <label for="edit-book-author">المؤلف</label> <input type="text" id="edit-book-author" required> </div>
                    <div class="form-group"> <label for="edit-book-edition">الطبعة</label> <input type="text" id="edit-book-edition" required> </div>
                    <div class="form-group"> <label for="edit-book-volumes">عدد المجلدات</label> <input type="text" id="edit-book-volumes" required> </div>
                    <div class="form-group"> <label for="edit-book-category-select">القسم</label> <select id="edit-book-category-select" required></select> </div>
                    <div class="form-group full-width"> <label for="edit-book-description">نبذة عن الكتاب</label> <textarea id="edit-book-description"></textarea> </div>
                    <div class="form-group full-width"> 
                        <label for="edit-book-image">تغيير صورة الغلاف</label> <input type="file" id="edit-book-image" accept="image/*"> 
                        <img id="image-preview" src="" alt="Image Preview">
                    </div>
                </div>
                <button type="submit" class="btn btn-success" style="margin-top: 20px;">حفظ التعديلات</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGrL1YVZwM4vIgIPSZtnao_TGS_glf3aw",
        authDomain: "book-fa11d.firebaseapp.com",
        projectId: "book-fa11d",
        storageBucket: "book-fa11d.firebasestorage.app",
        messagingSenderId: "771215422411",
        appId: "1:771215422411:web:55723a39729e3621b3fc4e",
        measurementId: "G-EB5M3PMRWK"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const analytics = firebase.analytics();

    const defaultLibraryData = [
        // PASTE THE FULL defaultLibraryData ARRAY HERE (Same as the one in the previous admin.html)
        // For brevity in this response, it's omitted but it's crucial for the initialize function.
        {
            "category": "قسم التفسير وعلوم القرآن",
            "books": [
                {"edition": "دار القلم الطبعة الرابعة 2016", "author": "السمين الحلبي", "title": "الدر المصون في علوم الكتاب المكنون", "volumes": "11", "image": "", "description": ""},
                {"edition": "دار اليمامة ط12/2014", "author": "محي الدين الدرويش", "title": "إعراب القرآن الكريم وبيانه", "volumes": "9", "image": "", "description": ""},
                {"edition": "ط2/2019", "author": "مركز الدراسات والمعلومات القرانية", "title": "موسوعة التفسير المأثور", "volumes": "24", "image": "", "description": ""},
                {"edition": "ط1/2001", "author": "ابن جرير الطبري", "title": "تفسير الطبري", "volumes": "26", "image": "", "description": ""},
                {"edition": "دار النفائس/ط1/2016", "author": "فضل حسن عباس", "title": "التفسير والمفسرون", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار الوفاء/ظ1/2014", "author": "محمد بن علي بن محمد الشوكاني", "title": "فتح القدير", "volumes": "5", "image": "", "description": ""},
                {"edition": "دار الحديث طبعة 2012", "author": "محمد حسين الذهبي", "title": "التفسير والمفسرون", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار بن حزم/ط2019", "author": "عبد الرحمان بن ناصر السعدي", "title": "تيسير الكريم الرحمن", "volumes": "1", "image": "", "description": ""},
                {"edition": "طبعة الأولى دار ابن الجوزي", "author": "محمد صالح العثيمين", "title": "تفسير القرآن الكريم سورة الكهف", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي", "author": "نخبة من العلماء", "title": "تفسير الميسر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1 1435 دار الميراث النبوي", "author": "صالح بن الفوزان الفوزان", "title": "دروس التفسير في المسجد الحرام", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط4 مركز التفسير للدراسات القرآنية", "author": "جماعة من علماء التفسير", "title": "المختصر في تفسير القرآن الكريم", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1 دار ابن الهيثم", "author": "لابن كثير", "title": "تفسير القرآن الكريم", "volumes": "4", "image": "", "description": ""},
                {"edition": "طبعة 1997 دار سحنون للنشر", "author": "طاهر بن عاشور", "title": "تفسير التحرير والتنوير", "volumes": "12", "image": "", "description": ""},
                {"edition": "مكتبة المعارف دون طبعة", "author": "عبد الرحمن بن ناصر السعدي", "title": "تيسير الكريم الرحمن في تفسير كلام المنان", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2015", "author": "عبد الحميد بن باديس", "title": "تفسير ابن باديس(مجالس التذكير)", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "جمال الدين البغدادي", "title": "زاد المسير في علم التفسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "محمد بن أحمد الأنصاري القرطبي", "title": "الجامع لأحكام القرآن", "volumes": "10", "image": "", "description": ""},
                {"edition": "ط2/2005", "author": "أحمد شاكر", "title": "عمدة التفسر عن الحافظ ابن كثر", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط2/2014", "author": "ابن مسعود البغوي", "title": "تفسير البغوي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2016", "author": "الأمير الصنعاني", "title": "تفسير غريب القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2013", "author": "محمد بن عبد الكريم الجزائري", "title": "توجيهات القرآن العظيم", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط3/2015", "author": "شهاب الدين الألوسي البغدادي", "title": "روح المعاني في تفسير القرآن العظيم والسبع المثاني", "volumes": "30", "image": "", "description": ""},
                {"edition": "ط1/1436 المؤسسة", "author": "محمد صالح العثيمين", "title": "تفسير القرآن الكريم", "volumes": "24", "image": "", "description": ""},
                {"edition": "ط2/1426 دار ابن حزم و الوفاء", "author": "احمد شاكر", "title": "عمدة التفسيير", "volumes": "3", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم القراءات وعلوم القرآن",
            "books": [
                {"edition": "ط1/2009", "author": "ابو جعفر النحاس", "title": "الناسخ والمنسوخ", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "ابن الجزري الديمشقي", "title": "النشر في القراءات العشر", "volumes": "5", "image": "", "description": ""},
                {"edition": "دار التقوى", "author": "ياسر محمد مرسي بيومي", "title": "التبيان المفصل لمتشابهات القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2015", "author": "محمد بن صالح العثيمين", "title": "احكام من القرآن الكريم", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2010", "author": "شمس الدين ابن الجزري", "title": "غاية النهاية في طبقات القراء", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "عماد الدين اسماعيل بن كثير", "title": "قصص القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2020", "author": "عبد الرحمان بن ناصر السعدي", "title": "قصص القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2007", "author": "ماهر احمد الصوفي", "title": "ايات الله في الأرقام ومعانيها وفواتح السور", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "ابو بكر محمد بن الحسين الأجري (اعداد عبد الرزاق البدر)", "title": "التبيان شرح اخلاق حملىة القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2012", "author": "الراغب الأصفهاني", "title": "المفردات في غريب القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2016", "author": "سعيد قاضي الزواوي", "title": "الجرجرية في ترتيل القرآن الكريم", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "محمد سالم بازمول", "title": "القراءات واثرها في التفسير والأحكام", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط5/2016", "author": "محمد فهد خاروف", "title": "الميسر في القراءات العشر المتواترة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2016", "author": "ابو عمر عثمان الاندلسي", "title": "التيسير في القراءات السبع", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "جلال الدين السيوطي", "title": "الإتقان في علوم القرآن", "volumes": "1(4)", "image": "", "description": ""},
                {"edition": "ط1/2012", "author": "قاسم بن قطلوبغا الحنفي", "title": "معجم غريب القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2021", "author": "محمد هشام طاهري", "title": "التبيان في انواع علوم القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "دون طبعة", "author": "محمد بن احمد الغرناطي", "title": "التسهيل لعلوم التنزيل", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2013", "author": "ابو محمد مكي القيسي", "title": "الكشف عن وجوه القراءات السبع و عللها وحججها", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط12/2017", "author": "عبد الفتاح عبد الغني القاضي", "title": "الوافي في شرح الشاطبية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2-1439-الرسالة العالمية", "author": "محمد حسن الشريف", "title": "المعجم في حروف المعاني القرآن الكريم", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط7/1442- مؤسسة الريان", "author": "عبد الله بن يوسف الجديع", "title": "مقدمات الأساسية في علوم القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1442-1 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "تعليق على قواعد الحسان المتعلقة في تفسير القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3-1443 مكتبة الريان", "author": "محمد بن سعد الطالبي", "title": "الصبح المشرق على رواية ورش من طريق ابي يعقوب الأزرق", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1438 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "شرح اصول في التفسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1436-دار الميراث", "author": "محمد بازمول", "title": "شرح مقدمة في اصول التفسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1410-دار الميراث", "author": "عبد الرحمان ابن القاسم النجدي", "title": "حاشية مقدمة التفسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1440-مكتبة دار المنهاج", "author": "صالح ال الشيخ", "title": "شرح مقدمة في اصول التفسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "1439/ دار الميراث", "author": "محمد بازمول", "title": "علم المناسبات في الور والايات", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/132-دار النوادر", "author": "سراج الدين الانصاري تح: احمد عيسى المعصراوي", "title": "البدور الزاهرة في القراءات العشر المتواترة", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط1/1437-دار ابن الجوزي", "author": "مشرف الغامدي", "title": "القراءات العشر المتواترة على الاوجه الراجحة المعتبرة بهامش المصحف", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1439-دار الغوثاني للدراسات", "author": "عبد الفتاحبن عبد الغاني القاضي", "title": "الوافي في شرح الشاطبية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1440-دار الغوثاني", "author": "غانم قدوري الحمد", "title": "شرح المقدمة الجزرية", "volumes": "1", "image": "", "description": ""},
                {"edition": "1439-دار الميراث", "author": "محمد بازمول", "title": "الاستنباط عند المفسرين ويليه معرفة الوجوه والنظائر في القرآن الكريم", "volumes": "1", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم الفقه وأصوله",
            "books": [
                {"edition": "ط5/2019", "author": "ابن القيم الجوزية", "title": "مجموع الرسائل", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2019", "author": "ابن القيم الجوزية", "title": "الكلام على مسئلة السماع", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "ابو ابراهيم اسماعيل بن يحي المزني", "title": "المختصر من علم الشافعي ومن معنى قوله", "volumes": "2", "image": "", "description": ""},
                {"edition": "دون طبعة", "author": "احمد ادريس عبده", "title": "الدرر الثمينة في فقه الطهارة والصلاة", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط3/2019", "author": "ابن القيم الجوزية", "title": "زاد المعاد في هدى خير العباد", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط2/2019", "author": "احمد حماني، ابن باز، ابن باديس، العثيمين", "title": "الجامع لأحكام المرأة المسلمة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "القسم العلمي بمؤسسة الدرر السنية", "title": "فقه الأيمان والنذور", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "سعيد بن علي القحطاني", "title": "احكام الجنائر", "volumes": "1", "image": "", "description": ""},
                {"edition": "2014", "author": "محمد بن صالح العثيمين", "title": "فقه العبادات", "volumes": "1", "image": "", "description": ""},
                {"edition": "2008", "author": "عبد الرحمان بن ناصر السعدي", "title": "ارشاد اولي البصائر و الالباب لنيل الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "عبد الحميد بن باديس", "title": "ايات واحاديث الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "دون طبعة", "author": "سعد بن تركي بن محمد الخفلان", "title": "احكام اللباس المتعلقة بالصلاة والحج", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1436", "author": "مازل محمد عيسى بن عيسى", "title": "الماء و اثره على الأحكام الشرعية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2009", "author": "محمد بن عمر بن سالم بازمول", "title": "شرح كتاب صفة صلاة النبي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1436", "author": "محمد بن صالح العثيمين", "title": "الإلمام ببعض ايات الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2002", "author": "حسين بن عودة العوايشة", "title": "الموسوعة الفقهية الميسرة", "volumes": "7", "image": "", "description": ""},
                {"edition": "2019", "author": "سليمان الرحيلي", "title": "فقه المعاملات المالية المعاصرة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2022", "author": "محمد علي فركوس", "title": "مختارات من نصوص احادث الأحكام في فقه مسائل الصيام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1433", "author": "ابن تيمية ( تح:صالح بن محمد الحسن)", "title": "شرح العمدة في بيان مناسك الحج و العمرة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2019", "author": "ابن تيمية (تح:محمد أجمل الاصلاحي)", "title": "شرح العمدة في بيان مناسك الحج و العمرة", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "عبد المحسن العباد البدر (شرح سليمان الرحيلي)", "title": "هداية السالك الى فوائد ومعاني تبصير الناسك وبأحكام المناسك", "volumes": "2", "image": "", "description": ""},
                {"edition": "2012", "author": "فتاوى اللجنة الدائمة للبحوث العلمية والافتاء", "title": "نوازل العبادات والمعاملات", "volumes": "2", "image": "", "description": ""},
                {"edition": "2014", "author": "صالح بن الفوزان الفوزان", "title": "من فقه المعاملات", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2009", "author": "نخبة من العلماء (تق:عبد العزيز ال الشيخ)", "title": "الفقه الميسر في ضوء الكتاب والسنة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "صالح بن الفوزان الفوزان", "title": "الملخص الفقهي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/2019", "author": "موسى اسماعيل", "title": "الوجيز في فقه العبادات على مذهب الامام مالك", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2013", "author": "محمد بن صالح العثيمين", "title": "شرح الممتع على زاد المستقنع", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط1/2020", "author": "بهاء الدين المقدسي", "title": "شرح المقنع", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط3/2015", "author": "منصور بن يونس البهوتي", "title": "شرح منتهى الإرادات", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "عبد الرحمان بن ناصر السعدي", "title": "الارشادات الى معرفة الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2012", "author": "محمد ناصر الدين الألباني", "title": "احكام الجنائز وبدعها", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1437", "author": "محمد بن صالح العثيمين", "title": "التعليق على رسالة حقيقة الصيام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "أبو عبد اللطيف الأنصاري", "title": "رسائل فقهية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "صالح بن الفوزان الفوزان", "title": "الملخص الفقهي", "volumes": "2", "image": "", "description": ""},
                {"edition": "2014", "author": "عبد الوهاب خلاف", "title": "علم اصول الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط6/1438", "author": "محمد بن صالح العثيمين", "title": "منظومة أصول الفقه و قواعده", "volumes": "1", "image": "", "description": ""},
                {"edition": "2011", "author": "عبد الرحمان الجزيري", "title": "الفقه على المذاهب الأربعة", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "ابو الوليد محمد بن رشد القرطبي", "title": "بغية المقتصد شرح بداية المجتهد", "volumes": "16", "image": "", "description": ""},
                {"edition": "ط5/2006", "author": "محمد ناصر الدين الألباني", "title": "تمام المنة في التعليق على فقه السنة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "السيد سابق", "title": "فقه السنة", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط4/2012", "author": "محمد بن علي بن محمد الشوكاني", "title": "السيل الجرار المتدفق على حدائق الأزهار", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط3/2020", "author": "ابو بكر محمد بن المنذر النيسابوري", "title": "الأوسط من السنن والإجماع والإختلاف", "volumes": "15", "image": "", "description": ""},
                {"edition": "ط3/2017", "author": "خالد العك", "title": "موسوعة الفقه المالكي", "volumes": "6", "image": "", "description": ""},
                {"edition": "ط2/2012", "author": "محمد سالم المباركي الشنقيطي", "title": "التسهيل والتكميل في الفقه المالكي", "volumes": "6", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "محمد بن يوسف غرناطي", "title": "التاج والإكليل لمختصر خليل", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "ابو بكر بن محمد المالكي", "title": "القبس في شرح موطأ مالك بن أنس", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "مالك بن أنس", "title": "المدونة الكبرى", "volumes": "6", "image": "", "description": ""},
                {"edition": "ط1/2014", "author": "الحبيب بن طاهر", "title": "الفقه المالكي وأدلته", "volumes": "(3-4-5-6-7)", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "احمد بن غنيم النفراوي المالكي", "title": "الفواكه الدواني على رسالة ابن ابي زيد القيرواني", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط2/2016", "author": "ابن النجار الدنياطي", "title": "الخلاصة الفقهية على مذهب السادة المالكية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2019", "author": "محمد بن عبد الباقي الزرقاني المصري المالكي", "title": "الشرح الزرقاني على موطأ الامام مالك", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط1/2020", "author": "ضياء الدين اسحاق الجندي", "title": "المختصر ''مختصر خليل''", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2014", "author": "القاضي ابو محمد عبد الوهاب البغدادي المالكي", "title": "التلقين في الفقه المالكي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2012", "author": "القاضي ابو محمد عبد الوهاب البغدادي المالكي", "title": "المعونة على مذهب علم المدينة", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "ابو الحسن علي المالكي القرطبي", "title": "إرشاد القاري الى فقه الأئمة الأربعة", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط4/1996", "author": "مشهور حسن سليمان", "title": "القول المبين في اخطاء المصلين", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "عبد الرحمان بن ناصر السعدي", "title": "الارشاد الى معرفة الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2011", "author": "خليل بن اسحاق الجندي", "title": "مختصر خليل في الفقه المالكي ومعه التيسير لمعاني مختصر خليل", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1997", "author": "ابو حفص عمر بن علي الانصاري الشافعي", "title": "الاعلام بفوائد عمدة الأحكام", "volumes": "11", "image": "", "description": ""},
                {"edition": "ط4/2013", "author": "عبد العظيم بن بدوي", "title": "الوجيز في فقه السنة والكتاب العزيز", "volumes": "1", "image": "", "description": ""},
                {"edition": "2013", "author": "ابو عمر يوسف ابن عبد البر القرطبي", "title": "الكافي في الفقه", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط3/2019", "author": "موسى اسماعيل", "title": "الوجيز في فقه العبادات على مذهب الامام مالك", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2009", "author": "أبو محمد علي بن حزم الأندلسي الظاهري", "title": "الإحكام في أصول الأحكام", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "أبو إسحاق الشاطبي", "title": "كتاب الموافقات", "volumes": "6", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "محمد بن علي الشوكاني", "title": "أدب الطلب ومنتهى الإرب", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط6/1438", "author": "محمد بن صالح العثيمين", "title": "منظومة أصول الفقه وقواعده", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "عبد الكريم زيدان", "title": "الوجيز في أصول الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2018", "author": "أبو العباس مظفر الدين أحمد ابن الساعاتي", "title": "البديع في أصول الفقه", "volumes": "3", "image": "", "description": ""},
                {"edition": "2015", "author": "سليمان الرحيلي", "title": "القواعد الفقهية المتعلقة بالبيوع", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "شهاب الدين أبي العباس القرافي المالكي", "title": "متن تنقيح الفصول في علم الأصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "فخز الدين محمد الرازي", "title": "المحصول في علم أصول الفقه", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/1999", "author": "ناصر الدين البيضاوي", "title": "نهاية السول في شرح منهاج الوصول إلى علم الأصول", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2020", "author": "عبد الوهاب خلاف", "title": "علم أصول الفقه وفي مقدمة خلاصة تاريخ التشريع الإسلامي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط8/1444", "author": "محمد سعد بن أحمد اليوبي", "title": "مقاصد الشريعة الإسلامية وعلاقاتها بالأدلة الشرعية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/2011", "author": "محمد بن علي الشوكاني", "title": "إرشاد الفحول إلى تحقيق الحق من علم الأصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "2016", "author": "سليمان الرحيلي", "title": "قواعد تعارض المصالح والمفاسد", "volumes": "1", "image": "", "description": ""},
                {"edition": "طبعة 2016", "author": "سليمان الرحيلي", "title": "التعريفات الأصولية في مجموع فتاوي شيخ الإسلام ابن تيمية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2018", "author": "سليمان الرحيلي", "title": "مباحث الأمن التي انتقدها شيخ الإسلام ابن تيمية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "سليمان الرحيلي", "title": "المدخل إلى تخريج الأصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "أبو عامر عبد الله الدّاغستاني", "title": "مقدمات المختصر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1439", "author": "جلال الدين السيوطي", "title": "الكوكب الساطع نظم جمع الجوامع", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "جمال يوسف زريوا", "title": "مقاصد الشريعة عند العلامة عبد الرحمن بن ناصر السعدي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1436", "author": "محمد بن صالح العثيمين", "title": "التعليق على القواعد والاصول الجامعة والفروق والتقاسيم البديعة النافعة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2020", "author": "بندر مناحي العريج", "title": "تخريج الفروع لى الأصول عند الكساني", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "أبو يزيد سليمان بن صفية", "title": "التحفة الصفية في شرح منظومة القواعد الفقهية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1430", "author": "بو بكر أحمد الخطيب البغدادي", "title": "الفقيه والمتفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "فخر الدين محمد الرازي", "title": "المنتخب من المحصول في أصول الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط13/1439", "author": "محمد بن حسين الجيزاني", "title": "معالم أصول الفقه عند أهل السنة والجماعة", "volumes": "1", "image": "", "description": ""},
                {"edition": "الفضيلة/ط1/2014", "author": "عبد الوهاب خلاف", "title": "علم أصول الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار النشر ط1/1425", "author": "محمد بن صالح العثيمين", "title": "فتح ذي الجلال والإكرام", "volumes": "15", "image": "", "description": ""},
                {"edition": "ط1/1439 - المؤسة", "author": "محمد بن صالح العثيمين", "title": "الشرح المختصر على بلوغ المرام", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط2/1442-ابن الجوزي", "author": "العراقي تح: محمد درويش", "title": "طرح التثريب في شرح التقريب", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط7/1442-ابن الجوزي", "author": "الصنعاني تح: محمد حلاق", "title": "سبل السلام الموصلة الى بلوغ المرام", "volumes": "9", "image": "", "description": ""},
                {"edition": "ط1/1443-الامام مسلم", "author": "ابراهيم الغامدي", "title": "أقوال الأمة الاربعة على مسائل زاد المستقنع وابن تيمية وابن عثيمين", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط3/1442-ابن الجوزي", "author": "عبد الله بن صالح الفوزان", "title": "منحة العلامة في شرح بلوغ المرام", "volumes": "11", "image": "", "description": ""},
                {"edition": "ط2/1439-دار عالم الفوائد", "author": "سامي بن محمد بن جار الله", "title": "الاختيارات الفقهية لشيخ الاسلام ابن تيمية لدى تلاميذه", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط5/1440-دار ابن الجوزي", "author": "تح رفعت فوزي عبد المطلب", "title": "الام للشافعي", "volumes": "11", "image": "", "description": ""},
                {"edition": "ط1/1434 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "مختارات من الطرق الحكمية في السياسة الشرعية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1441-دار المنهاج", "author": "سليمان القصير", "title": "شرح منهج السالكين ابن السعدي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1440-دار ابن الجوزي", "author": "عبد الله الجبرين", "title": "تسهيل الفقه الجامع لمسائل الفقه القديمة والمعاصرة", "volumes": "12", "image": "", "description": ""},
                {"edition": "ط1/1439-دار ابن الجوزي", "author": "محمد بن حسين الجيزاني", "title": "وثائق النوازل", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط2/1434 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "مختارات من اعلام الموقعين", "volumes": "1", "image": "", "description": ""},
                {"edition": "1442- دار الميراث النبوي", "author": "سليمان الرحيلي", "title": "فقه النكاح والعشرة بين الزوجين", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1443-دار الميراث النبوي", "author": "سليمان الرحيلي", "title": "فقه اللباس والزينة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1442-دار الميراث النبوي", "author": "سليمان الرحيلي", "title": "فقه عوارض الزوجية", "volumes": "1", "image": "", "description": ""},
                {"edition": "1437-2016", "author": "سليمان الرحيلي", "title": "المقدمات للبيت الفقهي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1443 دار ابن حزم", "author": "الدسوقي", "title": "حاشية الدسوقي على الشرح الكبير", "volumes": "15", "image": "", "description": ""},
                {"edition": "ط1/144دار البر", "author": "الابهري", "title": "شرح المخصر الكبير", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط1/1442 دار المحسن", "author": "ابن رشد", "title": "اختصار المبسوطة في اختلاف اصحاب مالك و اقواله", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الامان الرباط", "author": "محمد حمادة السبتي", "title": "مختصر ترتيب المدارك وتقريب المسالك لمعرفة اعيان مذهب مالك للقاضي عياض", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط3 /مكتبة الرشد-1424", "author": "يعقوب الباحسين", "title": "المشقة تجلب التيسيير", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة الرشد ط4/1437", "author": "يعقوب الباحسين", "title": "قاعدة اليقين لايزول بالشك", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1440-دار الميراث النبوي", "author": "السعدي", "title": "التعليقات النافعة على القواعد والاصول الجامعة", "volumes": "2", "image": "", "description": ""},
                {"edition": "1435 دار الميراث النبوي", "author": "بازمول", "title": "قطف الثمرات بشرح متن الورقات", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط/1441/20199 وكتبة الؤشد", "author": "عبد الكريم النملى", "title": "المهذب في علم أصول الفقه المقارن", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط6/1436 دار العواصم", "author": "عمد الحميد بن باديس تأليف الشيخ فركوس", "title": "الفتح الامامول شرح مبادئ الأصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1436 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "شرح قواعد الأصول ومعاقد الفصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1439 دار ابن الجوزي", "author": "الشافعي", "title": "الرسالة للشافعي", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/1438 مكتبة العلوم والحكم", "author": "مختار الشنقيطي", "title": "مذكرة في اصول الفقه", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1442 دار الناشر المتميز", "author": "شرح : سليمان الرحيلي", "title": "تيسير الوصول الى فهم الأصول من علم الاصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط5/1442 دار العواصم", "author": "الشريف تلمساني تح: الشيخ فركوس", "title": "مفتاح الوصول الى بناء الفروع على الأصول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط5/1438 دار ابن الجوزي", "author": "محمد الجيزاني", "title": "تهذيب الموفقات للشاطبي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1423-دار المنارة", "author": "شرح محمد الامين الشنقيطي تح اكمال : ولد سيدي ولد حبيب الشنقيطي", "title": "نثر الورود على مراقي السعود", "volumes": "1", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم الحديث وعلومه",
            "books": [
                {"edition": "2004", "author": "أحمد بن حجر العسقلاني", "title": "فتح الباري", "volumes": "14", "image": "", "description": ""},
                {"edition": "ط17/2019", "author": "محمد بن صالح العثيمين", "title": "شرح رياض الصالحين", "volumes": "6", "image": "", "description": ""},
                {"edition": "ط2/2018", "author": "أبو عمرو بن عبد البر النمري القرطبي", "title": "التمهيد", "volumes": "17", "image": "", "description": ""},
                {"edition": "ط1/2013", "author": "أبو عبد الله محمد البخاري", "title": "شرح الأدب المفرد", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/2011", "author": "أبو العلا محمد المباركفوري", "title": "تحفة الأحوذي في شرح جامع الترميذي", "volumes": "10", "image": "", "description": ""},
                {"edition": "ط1/2012", "author": "محي الدين يحي النووي", "title": "المنهاج شرح صحيح مسلم بن الحجاج", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "عبد الله عبد الرحمن البسام", "title": "توضيح الأحكام من بلوغ المرام", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط2/2012", "author": "البوني", "title": "تفسير الموطأ للبوني", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "عبد العزيز بن باز", "title": "الإفهام في شرح عمدة الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "محمد بن صالح العثيمين", "title": "تنبيه الأفهام شرح عمدة الأحكام", "volumes": "2", "image": "", "description": ""},
                {"edition": "2017", "author": "عبد الله عبد الرحمن البسام", "title": "تيسير العلّام شرح عمدة الأحكام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2013", "author": "أبو عبد الرحمن شرف الحق الصديقي أبادي", "title": "عون المعبود", "volumes": "7(14)", "image": "", "description": ""},
                {"edition": "ط3/1439", "author": "محمد بن علي بن محمد الشوكاني", "title": "نيل الأوطار", "volumes": "16", "image": "", "description": ""},
                {"edition": "ط1/2021", "author": "أبو العباس أحمد القسطلاني الشافعي", "title": "إرشاد الساري لشرح صحيح البخاري", "volumes": "20", "image": "", "description": ""},
                {"edition": "ط4/2015", "author": "الإمام أحمد", "title": "مسند الإمام أحمد", "volumes": "52", "image": "", "description": ""},
                {"edition": "ط1/2014", "author": "أبو الفضل أحمد بن حجر العسقلاني", "title": "تهذيب التهذيب", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "أبو عبد الله إسماعيل محمد البخاري", "title": "التاريخ الكبير", "volumes": "12", "image": "", "description": ""},
                {"edition": "ط1/2009", "author": "محمد ناصر الدين الألباني", "title": "سلسلة الأحاديث الضعيفة والموضوعة", "volumes": "4", "image": "", "description": ""},
                {"edition": "2001", "author": "أبو بكر أحمد البيهقي", "title": "معرفة السنن والاثار", "volumes": "7", "image": "", "description": ""},
                {"edition": "", "author": "أبو بكر أحمد البيهقي", "title": "السنن الكبرى", "volumes": "11", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "عزالدين بنالأثير الجزري", "title": "أسد الغابة في معرفة الصحابة", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط2/1423", "author": "أبو الفضل أحمد بن علي العسقلاني", "title": "تقريب التهذيب", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1985", "author": "ناصر الدين الألباني", "title": "إرواء الغليل في تخريج أحاديث منار السبيل", "volumes": "9", "image": "", "description": ""},
                {"edition": "ط3/2011", "author": "أبو الحسن علي الدارقطني", "title": "العلل", "volumes": "10", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "أبو جعفر محمد بن حماد العقيلي", "title": "كتاب الضعفاء", "volumes": "7", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "بدر الدين الحسيني", "title": "الدرر البهية في شرح المنظومة البيقونية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2013", "author": "عبد العزيز بن عبد الله بن باز", "title": "فوائد من شرح اختصار علوم الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2009", "author": "بدر الدين الزركشي", "title": "النكت على ابن الصلاح", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/2015", "author": "فواز بن محمد رشيد الجزائري", "title": "مجموع كلام الألباني على رجال تقريب العسقلاني", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2019", "author": "أبو زكرياء يحي بن شرف النووي", "title": "إرشاد طلاب الحقائق إلى معرفة سنن خير الخلائق", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "القاضي أبو محمد الحسن الرّامهرمزي", "title": "المحدّث الفاضل بين الراوي والواعي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2018", "author": "أبو بكر أحمد الخطيب البغدادي", "title": "كتاب الرحلة في طلب الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2006", "author": "تقي الدين محمد بن دقيق العيد", "title": "الاقتراح في بيان الاصطلاح", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1999", "author": "الحافظ أحمد بن حجر العسقلاني", "title": "تغليق التعليق على صحيح البخاري", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "محمد بن عمر سالم بازمول", "title": "مباحث في علوم الحديث دراسات مقارنة في مصطلح الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1442 حفاظ الوحيين", "author": "عبد الحق الاشبيلي", "title": "الجمع بين الصحيحين مهذبا للحفاظ", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "ابن الصّلاح الشهرزوري", "title": "مقدمة ابن الصّلاح علوم الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2017", "author": "أبو بكر أحمد الخطيب البغدادي", "title": "شرف أصحاب الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2011", "author": "الحافظ جلال الدين السيوطي", "title": "شرح ألفية السيوطي في علم الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2016", "author": "الحافظ ابن حجر العسقلاني (شرح ابن عثيمين)", "title": "شرح نزهة النظر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2011", "author": "الحافظ ابن حجر العسقلاني (عبق عليه نفيس أحمد مصباحي)", "title": "شرح نزهة النظر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/2019", "author": "أبو عبد الله عثمان الذهبي", "title": "ميزان الاعتدال في نقد الرجال", "volumes": "5", "image": "", "description": ""},
                {"edition": "ط1/2016", "author": "مجد الدين بن محمد الجزري", "title": "النهاية في غريب الحديث والأثر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط/1441 دار ابن الجزي", "author": "ابي بكر السيوطي عناية مازن بن محمد المرسساوي", "title": "تدريب الراوي في شرح تقريب النواوي", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط2/1438-دار الميراث النبوي", "author": "الشيخ ربيع بن هادي", "title": "النكت على كتاب ابن صلاح للحافظ ابن حجر", "volumes": "2", "image": "", "description": ""},
                {"edition": "1440-دار الميراث", "author": "محمد بازمول", "title": "التخريج ودراسة الاسنيد", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3/1442-دار ابن الجوزي", "author": "احمد شاكر", "title": "الباعث الحثيث شرح اختصار علوم الحديث", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/144-مكتبة دار المنهاج", "author": "محمد الزهراني", "title": "علم الرجال", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1434-دار العبيكان", "author": "عبد العزيز العبد اللطيف", "title": "ضوابط الجرح والتعديل", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط7/140- دار المنهاج", "author": "عبد الكريم الخضير", "title": "تحقيق الرغبة في تحقيق النخبة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "محمد بن اسماعيل", "title": "صحيح البخاري", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "مسلم بن الحجاج", "title": "صحيح مسلم", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "ابي داود", "title": "سنن ابي داود", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "الترميذي", "title": "جامع الترميذي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "النسائي", "title": "سنن النسائي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438 دار الفيحاء و دار المنهل", "author": "ابن ماجة", "title": "سنن ابن ماجة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/2010 دار ابن الجوزي القاهرة", "author": "الإمام مالك", "title": "الموطأ رواية يحي بن يحي الليثي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1442- دار القلم", "author": "الامام مالك تح: صفوان داوودي", "title": "كتاب الموطأ رواية محمد بن حسن الشيباني", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط5/1441- دار القلم", "author": "صالح الشلمي", "title": "معالم السنة النبوية", "volumes": "3", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم الفتاوى",
            "books": [
                {"edition": "دار ابن حزم ط4/2011", "author": "تقي الدين بن تيمية", "title": "مجموع الفتاوى لابن تيمية", "volumes": "20", "image": "", "description": ""},
                {"edition": "الرسالة العلمية ط1/2009", "author": "عبد السلام بن عبد الله السليمان", "title": "الفوائد العلمية من الدروس البازية", "volumes": "8/10أجزاء", "image": "", "description": ""},
                {"edition": "الرئاسة العامة للبحوث العلمية والافتاء/ط1/2012", "author": "عبد العزيز بن باز", "title": "فتاوى نور على الدرب", "volumes": "25", "image": "", "description": ""},
                {"edition": "مكتبة ابن عباس/ط1/2014", "author": "محمد بن صالح العثيمين", "title": "سلسة محاضرات فتاوى اللقاء الشهري", "volumes": "4", "image": "", "description": ""},
                {"edition": "مؤسسة الشيخ محمد بن صالح العثيمين الخيرية/ط1/1438", "author": "محمد بن صالح العثيمين", "title": "لقاءات الباب المفتوح", "volumes": "10", "image": "", "description": ""},
                {"edition": "عالم المعرفة/ط2015", "author": "مصطفى صابر", "title": "فتاوى الشبخ أحمد حمّاني", "volumes": "4", "image": "", "description": ""},
                {"edition": "ط2/2014/ الرئاسة العامة للبحوث العلمية والافتاء", "author": "عبد العزيز بن باز", "title": "مجموع فتاوى ومقالات متنوعة", "volumes": "غير محدد", "image": "", "description": ""},
                {"edition": "دار المحسن /ط1/2008", "author": "اللجنة الدائمة للبحوث العلمية والإفتاء", "title": "فتاوى المرأة المسلمة", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار المداد/ طبعة2008", "author": "اللجنة الدائمة للبحوث العلمية والإفتاء", "title": "آداب المرأة المسلمة", "volumes": "1(2)", "image": "", "description": ""},
                {"edition": "دار ابن حزم/ ط1/2020", "author": "جمعها: مصطفى صابر، تقديم: محمد سكحال", "title": "فتاوى علماء جمعية العلماء المسلمين الجزائريين واختياراتهم الفقهية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الإمام مالك/ط3/2019", "author": "موسى إسماعيل", "title": "الفتاوى الشرعية في المسائل الدينية والدنيوية", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار الغد الجديد/ط1/2014", "author": "اللجنة الدائمة للبحوث العلمية والإفتاء", "title": "فتاوى المرأة المسلمة (نسختان)", "volumes": "غير محدد", "image": "", "description": ""},
                {"edition": "ط1/1439-المؤسسة", "author": "محمد بن صالح العثيمين", "title": "فتاوى سؤال على الهاتف", "volumes": "2", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم التاريخ والسيرة والتراجم",
            "books": [
                {"edition": "دار الكتب العلمية/طبعة2012", "author": "أحمد بن محمد المقري التلمساني", "title": "نفح الطيب من غصن الأندلس الرطيب", "volumes": "11", "image": "", "description": ""},
                {"edition": "دار المعارف/طبعة2014", "author": "أبو جعفر محمدبن جرير الطبري", "title": "تاريخ الطبري تاريخ الرسل والملوك", "volumes": "11", "image": "", "description": ""},
                {"edition": "ط6/1442-دار ابن كثير", "author": "ابن كثير", "title": "البداية والنهاية", "volumes": "21", "image": "", "description": ""},
                {"edition": "دار الكتاب العربي/ طبعة2017", "author": "محمد الميلي", "title": "تاريخ الجزائر في القديم والحديث", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار الكتاب العربي/ طبعة2017", "author": "عز الدين علي الشيباني ابن اثير", "title": "الكامل في التاريخ", "volumes": "11", "image": "", "description": ""},
                {"edition": "دار الحديث/طبعة2006", "author": "ابن كثير", "title": "البداية والنهاية", "volumes": "6", "image": "", "description": ""},
                {"edition": "دار الإمام مالك/ط4/2018", "author": "ابن كثير", "title": "البداية والنهاية", "volumes": "8", "image": "", "description": ""},
                {"edition": "daؤ ابن كثير/ط1/2020", "author": "محمد بن يعقوب المقدسي الخليلي", "title": "إعلام الأصابة بأعلام الصحابة", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة الإمام الزهري/ط1/2017", "author": "أبو محمد بن هشام البصري", "title": "مختصر سيرة الرسول", "volumes": "1", "image": "", "description": ""},
                {"edition": "المنهاج القويم/ط1/2021", "author": "أبو عيسى محمد الترمذي", "title": "شمائل النبي صلى الله عليه وسلم", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الوفاء/ط23/1999", "author": "صفي الرحمن المباركفوري", "title": "الرحيق المختوم", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة ابن تيمية/", "author": "أبو عبد الله شمس الدين الذهبي", "title": "ذيل تذكرة الحفاظ", "volumes": "5", "image": "", "description": ""},
                {"edition": "المكتبة العصرية /ط1/2014", "author": "أبو القاسم عبد الرحمن السهيلي", "title": "شرح السيرة النبوية لابن هشام", "volumes": "4", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط4/2012", "author": "علي محمد الصلابي", "title": "السيرة النبوية عرض وقائع وتحليل أحداث", "volumes": "1", "image": "", "description": ""},
                {"edition": "نوميديا/ دار الوطن/ط1", "author": "أبو محمد بن هشام البصري المعفري", "title": "السيرة النبوية المعروفة بسيرة ابن هشام", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن حزم/طبعة2010", "author": "صفي الرحمن المباركفوري", "title": "الرحيق المختوم", "volumes": "1", "image": "", "description": ""},
                {"edition": "الدار العالمية/ط1/2018", "author": "أبو إسحاق محمد الترمذي (شرحها: عبد الرزاق البدر)", "title": "شرح شمائل النبي", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الميراث النبوي/دار الفضيلة/ط1/2019", "author": "ابن أبي العز الحنفي (شرح عبد الرزاق البدر)", "title": "شرح الأرجوزة الميئية في ذكر حال خير البرية(نسختان)", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط1/2017", "author": "أبو نعيم الأصبهاني", "title": "حلية الأولياء وطبقات الأصفياء", "volumes": "6", "image": "", "description": ""},
                {"edition": "الرسالة العلمية /13/2019", "author": "شمس الدين محمد عثمان الذهبي", "title": "سير أعلام النبلاء", "volumes": "23", "image": "", "description": ""},
                {"edition": "العاصمة/ط1/1410", "author": "أبو سليما من محمد الربعي الدمشقي", "title": "تاريخ مولد العلماء ووفاتهم", "volumes": "2", "image": "", "description": ""},
                {"edition": "الميراث النبوي/طبعة2019", "author": "سليمان الرحيلي", "title": "الإعلام بالأئمة الأربعة الأعلام", "volumes": "1", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم اللغة والأدب",
            "books": [
                {"edition": "المكتبة العصرية /ط/2014", "author": "جلال الدين السيوطي", "title": "الأشباه والنظائر في النحو", "volumes": "4", "image": "", "description": ""},
                {"edition": "دار الفكر/ط1/2008", "author": "جمال الدين ابن منظور", "title": "لسان العرب", "volumes": "6", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط1/2015", "author": "جمال الدين ابن منظور", "title": "لسان العرب", "volumes": "ج2و3", "image": "", "description": ""},
                {"edition": "دار القلم/الدار الشامية/ط4/2013", "author": "عبد الرحمن حسنالمي", "title": "البلاغة العربية أسسها وعلومها وفنونها", "volumes": "2", "image": "", "description": ""},
                {"edition": "مكتبة الرشد/ط11/1439", "author": "محمد بن صالح العثيمين", "title": "شرح الأجرومية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الغد الجديد/ط1/2007", "author": "مصطفى الغلاييني", "title": "جامع الدروس العربية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط1/2018", "author": "أبو محمد ابن هشام الأنصاري", "title": "شرح قطر الندى وبل الصدى", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة دار الفجر/ط5/2019", "author": "علي جارم ومصطفى أمين", "title": "البلاغة الواضحة في البيان والمعاني والبديع", "volumes": "1", "image": "", "description": ""},
                {"edition": "شركة القدس/ط3/1992", "author": "عبد القاهر الجرجاني", "title": "دلائل الإعجاز", "volumes": "1", "image": "", "description": ""},
                {"edition": "الناشر المتميز/ط1/2019", "author": "بو القاسم خلف الأندلسي القرطبي", "title": "الفوائد المنتخبة والحكايات المستغربة", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار النوادر/ط2/2012", "author": "محمد أحمد الدالي", "title": "الحصائل في علوم العربية وتراثها", "volumes": "3", "image": "", "description": ""},
                {"edition": "الكتب العلمية/ط1/2008", "author": "محمد سالم ولد عدود", "title": "الطرة توشيح لامية الأفعال لابن مالك", "volumes": "جزئين في مجلد", "image": "", "description": ""},
                {"edition": "دار الفجر/طبعة2010", "author": "محمد محي الدين عبد الحميد", "title": "التحفة السنية بشرح المقدمة الأجرومية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دارالفجر/ط5/2021", "author": "علي جارم ومصطفى أمين", "title": "النحو الواضح في قواعد اللغة العربية", "volumes": "1", "image": "", "description": ""},
                {"edition": "مؤسسة الرسالة/ط1/2019", "author": "بهاء الدين عبد الله بن عقيل", "title": "شرح ابن عقيل على ألفية ابن مالك", "volumes": "2(4)", "image": "", "description": ""},
                {"edition": "دار السلام/ط1/2018", "author": "أبو بكر محمد ابن السراج", "title": "الأصول في النحو", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار النوادر/ط1/2008", "author": "ناصر الدين الدمشقي", "title": "التبيان لبديعة البيان", "volumes": "3", "image": "", "description": ""},
                {"edition": "نجيبويه المعرفية/ط1/2020", "author": "أبو حامد المكي الرباطي المغربي", "title": "شرح القصيدة الشمقمقية (اقتطاف زهرات الأفنان من دوحة قافية ابن الونان لأبي العباس الشمقمق)", "volumes": "4", "image": "", "description": ""},
                {"edition": "مكتبة المعارف/ط2/2017", "author": "الحسن بن قاسم المرادي", "title": "شرح ألفية ابن مالك", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار الفجر/ط4/2020", "author": "علي جارم ومصطفى أمين", "title": "النحو الواضح في قواعد اللغة العربية", "volumes": "1(3)", "image": "", "description": ""},
                {"edition": "مكتبة اليسر/ط1/2020", "author": "أبو محمد عبد الله ابن هشام الأنصاري", "title": "شرح قطر الندى وبل الصدى", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار المستقبل/مكتبة الإمام الألباني/ط3/2007", "author": "محمد الصغير العبادلي المقطري( تقديم مقبل الوداعي)", "title": "الحلل الذهبية على التحفة السنية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دارا الفجر/ط1/2018", "author": "جمال الدين بن هشام", "title": "اتحاف ذوي الألباب. الجامع بين الإعراب عن قواعد الإعراب", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار المنهج/ط1/2014", "author": "أبو عبد الله محمد سعيد رسلان", "title": "فضل العربية ووجوب تعلمها على المسلمين", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط1/2015", "author": "أحمد بن محمد عبد ربه الأندلسي", "title": "العقد الفريد", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار ابن الجوزي/ط6/2019", "author": "محمد بن صالح العثيمين", "title": "شرح ألفية ابن مالك", "volumes": "1", "image": "", "description": ""},
                {"edition": "المكتب الإسلامي/ط1/2008", "author": "أبو محمد عبد الله بن قتيبة", "title": "عيون الأخبار", "volumes": "4", "image": "", "description": ""},
                {"edition": "القدس/ط1/2013", "author": "أحمد بن إبراهيم الهاشمي", "title": "جواهر الأدب", "volumes": "2", "image": "", "description": ""},
                {"edition": "الخانجي/ط3/2013", "author": "عادل سليمان جمل", "title": "جمهرة مقالات الأستاذ محمود شاكر", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار الأثار/ط1/2013", "author": "إبراهيم بن محمود المصري", "title": "مجموع مقالات أحمد بن محمد شاكر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1440-المؤسسة", "author": "محمد بن صالح العثيمين", "title": "المناهي اللفظية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1442-مكتبة الفجر", "author": "الثعالبي", "title": "فقه اللغة وسر العربية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1432-المكتبة السلفية", "author": "محب الدين الخطيب", "title": "الحديقة مجموعة ادب بارع وحكم بليغة", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/1442دار الفيحاء والدقاق", "author": "خالد الأزهري", "title": "موصل الطلاب الى قواعد الاعراب ومع منظومةىالزواوي", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1441 دار الفيحاء", "author": "احمد بن محمد الحملاوي", "title": "شذا العرف في فن الصرف", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط6/1442-دار ابن الجوزي", "author": "عبد الله الفوزان", "title": "دليل السالك إلى الفية ابن مالك", "volumes": "2", "image": "", "description": ""},
                {"edition": "ط1/1437 المؤسسة", "author": "محمد بن صالح العثيمين", "title": "شرح الدرة اليتيمة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1441- دار الطيبة الخضراء", "author": "ابو سهيل الفضفري", "title": "البلغة في فنون البلاغة", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط4/1428", "author": "ابن القاسم", "title": "حاشية الاجرومية", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1439-الميراث النبوي", "author": "عبد الرحمان بن عوف كوني", "title": "جوب جوف الفرى بشرح واعراب لامية الشنفرى", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط6/1442-مكتبة الرشد", "author": "محمد بن صالح العثيمين", "title": "مختصر مغني اللبيب عن كتب الاعاريب لابن هشام", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط3-مكتبة الخانجي", "author": "الاصمعي", "title": "اشتقاق الاسماء", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1440-مكتبة الشافعي", "author": "خالد عبد العزيز", "title": "النحو التطبيقي", "volumes": "1", "image": "", "description": ""}
            ]
        },
        {
            "category": "قسم السلوك والمواعظ والرقائق",
            "books": [
                {"edition": "دارالإمام البخاري/ط1/2014", "author": "صالح بن عبد العزيز آل الشيخ", "title": "مجموع الخطب المنبرية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ابن حزم/مركز الإمام الثعالبي/ط1/2009", "author": "أبو سليمان داود السعدي (تقديم: محمد مرزاق)", "title": "شرح أدب الكاتب", "volumes": "1", "image": "", "description": ""},
                {"edition": "مركز البحوث الإسلامية/دار ابن حزم/ط3/2009", "author": "أبو محمد علي بن حزم الأندلسي", "title": "كتاب الأخلاق والسير", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الميراث النبوي/طبعة2018", "author": "أبو حاتم محمدبن حبان البسي", "title": "روضة العقلاء وما يحتاج إليه الملوك والنبلاء", "volumes": "1", "image": "", "description": ""},
                {"edition": "الإمام الزهري/ط1/2019", "author": "عبد الرحمن بن ناصر السعدي", "title": "بهجة قلوب الأبرار وقرة عيون الأخيار في شرح جوامع الأخبار", "volumes": "1", "image": "", "description": ""},
                {"edition": "المكتب الإسلامي/ط1/2007", "author": "زين الدين بن رجب الحنبلي", "title": "لطائف المعارف (نسختان)", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الفرقان/ابن باديس/ط1/2015", "author": "عبد الرزاق البدر", "title": "الدرر البهية في الخطب المنبرية", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط2/2019", "author": "أبو عبد الله محمد بن القيم الجوزية", "title": "مدارج السالكين في منازل السائرين", "volumes": "4", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط2/2021", "author": "علي العمران-محمدأجمل الإصلاحي/محمد عزيز شمس/نبيل السندي", "title": "الفهارس العلمية لاثار الإمام ابن قيم الجوزية", "volumes": "2", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ ابن حزم/ط4/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "الفوائد", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط4/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "طريق الهجرتين وباب السعادتين", "volumes": "2", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط5/2019", "author": "أبو عبد الله محمدابن قيم الجوزية", "title": "بدائع الفوائد", "volumes": "5", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط4/2019", "author": "أبو عبد الله محمدابن قيم الجوزية", "title": "التبيان في أيمان القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط4/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "الداء والدواء", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط3/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "كتاب الروح", "volumes": "غير محدد", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط5/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "جلاء الأفهام في فضل الصلاة والسلام على خير الأنام", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط4/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "عُدّة الصابرين وذخيرة الشاكرين", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط5/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "الوابل الصيب ورافع الكلم الطيب", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط3/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "مفتاح دار السعادة ومنشور ولاية العلم والإرادة", "volumes": "3", "image": "", "description": ""},
                {"edition": "دار الهدي النبوي/دار الفضيلة/ط1/2011", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "طريق الهجرتين وباب السعادتين", "volumes": "1", "image": "", "description": ""},
                {"edition": "عطاءات العلم/ابن حزم/ط3/2019", "author": "أبو عبد الله محمد ابن قيم الجوية", "title": "إغاثة اللهفان من مصايد الشيطان", "volumes": "2", "image": "", "description": ""},
                {"edition": "دار ابن كثير/ط6/2018", "author": "أبو الحسن علي بن حبيب البصري الماوردي", "title": "أدب الدنيا والدين", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة المعارف/ط1/2001", "author": "محمود مهدي الإستانبولي", "title": "تحفة العروس أو الزواج الإسلامي السعيد", "volumes": "1", "image": "", "description": ""},
                {"edition": "الناشر المتيمز/ط1/2018", "author": "أبو محمد عبد الرحمن حاتم الرازي", "title": "آداب الشافعي ومناقبه", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة الرشد/ط5/2018", "author": "تقي الدين أحمد بن تيمية", "title": "التحفة العراقية في الأعمال القلبية", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار الإمام البخاري/ط1/2015", "author": "عبد الله الأصبهاني", "title": "كتاب الأمثال في الحديث النبوي", "volumes": "1", "image": "", "description": ""},
                {"edition": "الإمام مالك/طبعة2018", "author": "عماد الدين بن كثير الدمشقي", "title": "قصص الأنبياء", "volumes": "1", "image": "", "description": ""},
                {"edition": "مدار الوطن/ط4/2014", "author": "عبد الله الطيّار وسامي المبارك", "title": "فتح الحق المبين في علاج الصرع والسحر والعين", "volumes": "1", "image": "", "description": ""},
                {"edition": "الدار العالمية/ط1/2015", "author": "محي الدين بن شرف النووي", "title": "الأذكار من كلام سيد الأبرار", "volumes": "1", "image": "", "description": ""},
                {"edition": "مكتبة الإمام الألباني/ط2/2007", "author": "أبو العباس أحمد شملان", "title": "صحيح الأثر فيما يتبع الميت من الخير والشر", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1438-مدار الوطن للنشر", "author": "عبد الرحمان بن ناصر السعدي", "title": "فتح الرحيم الملك العلام في علم العقائد والتوحيد والأخلاق والاحكام المستنبطة من القرآن", "volumes": "1", "image": "", "description": ""},
                {"edition": "1437-دار الميراث النبوي", "author": "محمد بازمول", "title": "خبر الكتاب", "volumes": "2", "image": "", "description": ""},
                {"edition": "ك3/1442-دار العاصمة", "author": "فيصل بن عبد العزيز ال مبارك", "title": "تطريز رياض الصالحين", "volumes": "2", "image": "", "description": ""},
                {"edition": "1438-دار الميراث النبوي", "author": "محمد بازمول", "title": "الكاشكول فوائد علمية وآدب شرعية", "volumes": "1", "image": "", "description": ""},
                {"edition": "1439-دار الميراث النبوي", "author": "ابن حبان تح: محمد ابن عوض المصري", "title": "روضة العقلاء وما يحتاج إليه الملوك والنبلاء", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1440 در ابن الجوزي", "author": "الماوردي تح: علي عبد المقصود رضوان", "title": "اداب الدين والدنيا", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط1/1419-المكتب الاسلامي", "author": "صالح الشامي", "title": "تهذيب حلية الأولياء", "volumes": "3", "image": "", "description": ""},
                {"edition": "1437-دار الميراث النbوي", "author": "محمد بازمول", "title": "على جدران الفايسبوك", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط1/1442-دار طيبة الخضراء", "author": "عبد الله الأعظمي", "title": "فضائل الصحابة الصحيحة على منهج المحدثين", "volumes": "1", "image": "", "description": ""},
                {"edition": "الأثار/الأمام مالك/ط2/2021", "author": "أم عبد الله بنت الشيخ مقبل الوداعي", "title": "نصيحتي للنساء", "volumes": "1", "image": "", "description": ""},
                {"edition": "أهل الأثر/الإمام مالك/ط1/2019", "author": "جمال الدين جمعة الخراز", "title": "موسوعة الأخلاق", "volumes": "1", "image": "", "description": ""},
                {"edition": "الثريا/ط1/2002", "author": "محمد بن صالح العثيمين", "title": "كتاب العلم", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار المنهج/ط1/2015", "author": "سعيد رسلان", "title": "فضل العلم وآداب طلبته وطرق تحصيله وجمعه", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار القاسم/ط2/1421", "author": "عبد الملك القاسم", "title": "درسا لمن أدرك رمضان", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار ماجد عسيري/طط1/2004", "author": "سيد بن حسين العفاني", "title": "فرسان النهار من الصحابة الأخيار", "volumes": "3", "image": "", "description": ""},
                {"edition": "الإمام مسلم/الدار الأثرية/ط1/1441", "author": "عبد الرزاق البدر", "title": "الجامع للمؤلفات والرسائل", "volumes": "22", "image": "", "description": ""},
                {"edition": "دار الحديث/ط3/2014", "author": "أبو عبد الله محمد البخاري", "title": "بر الوالدين", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار المحسن/ط1/2012", "author": "محمد بن عبد الوهاب", "title": "كتاب الكبائر", "volumes": "2", "image": "", "description": ""},
                {"edition": "كنوز الرشيد/ط1/2013", "author": "ابن قيم الجوزية", "title": "روضة المحبين ونزهة المشتاقين", "volumes": "1", "image": "", "description": ""},
                {"edition": "الكتب العلمية/طبعة2008", "author": "أبو عمر يوسف القرطبي", "title": "بهجة المجالس وأنس المجالس", "volumes": "3", "image": "", "description": ""},
                {"edition": "ابن الجوزي/ط1/2018", "author": "أبو عمر يوسف ابن عبد البر", "title": "جامع بيان العلم وفضله", "volumes": "1", "image": "", "description": ""},
                {"edition": "الإمام البخاري ط1/2016", "author": "عبد البر النمري", "title": "جامع بيان أخذ العلم وفضله", "volumes": "1و2", "image": "", "description": ""},
                {"edition": "الإمام مسلم/ط1/2021", "author": "الألباني", "title": "مسائل وأجوبتها", "volumes": "1", "image": "", "description": ""},
                {"edition": "الإمام الزهري/ط1/1438", "author": "عبد الرحمن بن ناصر السعدي", "title": "تاريخ الوصول إلى العلم المأمول", "volumes": "1", "image": "", "description": ""},
                {"edition": "ط2/1442", "author": "صالح بن سعد القحطاني", "title": "مدارج الطلب", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار القلم ط5/1442-", "author": "ابن الجوزي تح: حسن السويدان", "title": "صيد الخاطر", "volumes": "1", "image": "", "description": ""},
                {"edition": "الإمام البخاري/ط1/2016", "author": "مجهول", "title": "الانتقاء في فضائل الأئمة الثلاثة الفقهاء", "volumes": "1", "image": "", "description": ""},
                {"edition": "الناشر المتميز/ط1/2018", "author": "أبو محمد عبد الرحمن الرازي", "title": "آداب الشافعي ومناقبه", "volumes": "1", "image": "", "description": ""},
                {"edition": "دار المنهاج/ط3/1436", "author": "أبو عبد الله محمد القرطبي", "title": "كتاب التذكرة", "volumes": "3", "image": "", "description": ""},
                {"edition": "ط4/1439-", "author": "عبد المحسن العباد البدر", "title": "كتب ورسائل عبد المحسن بن حمد العباد البدر", "volumes": "8", "image": "", "description": ""}
            ]
        }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const password = 'admin2025';

        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('login-error');
        
        const addCategoryForm = document.getElementById('add-category-form');
        const addBookForm = document.getElementById('add-book-form');
        const manageBookList = document.getElementById('manage-book-list');
        const categorySelectForBookAdd = document.getElementById('book-category');
        const initializationSection = document.getElementById('initialization-section');
        const initializeDbBtn = document.getElementById('initialize-db-btn');
        const adminSearchInput = document.getElementById('admin-search-input');

        const editModalOverlay = document.getElementById('edit-modal-overlay');
        const editBookForm = document.getElementById('edit-book-form');
        const closeModalBtn = document.querySelector('.modal-close-btn');

        let libraryData = []; // Stores {id, categoryName, order, books} from Firestore
        let categoryNameMap = {}; // To quickly find category ID by name for dropdowns


        const normalizeText = (text) => {
            if (!text) return '';
            return text.replace(/[أإآ]/g, 'ا').replace(/ة/g, 'ه').replace(/[ًٌٍَُِّْ]/g, '').toLowerCase().trim();
        };

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (passwordInput.value === password) {
                document.getElementById('main-container').style.maxWidth = '900px'; // Keep existing logic
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'block';
                loadAndRenderAdminPanel();
            } else {
                loginError.style.display = 'block';
            }
        });
        
        async function populateFirestoreFromDefaults() {
             if (!confirm("سيتم مسح جميع البيانات الحالية واستبدالها بالبيانات الافتراضية. هل أنت متأكد؟")) {
                return;
            }
            try {
                const existingCategories = await db.collection("categories").get();
                const batch = db.batch();
                existingCategories.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
                alert('تم مسح البيانات الحالية.');

                const addBatch = db.batch();
                defaultLibraryData.forEach((categoryItem, index) => {
                    const categoryDocRef = db.collection("categories").doc();
                    const booksWithDefaults = categoryItem.books.map(book => ({
                        ...book,
                        image: book.image || "",
                        description: book.description || ""
                    }));
                    addBatch.set(categoryDocRef, {
                        categoryName: categoryItem.category,
                        order: index,
                        books: booksWithDefaults
                    });
                });
                await addBatch.commit();
                alert('تمت تهيئة قاعدة البيانات بالبيانات الافتراضية بنجاح!');
                initializationSection.style.display = 'none';
            } catch (error) {
                console.error("Error initializing Firestore: ", error);
                alert(`حدث خطأ أثناء تهيئة قاعدة البيانات: ${error.message}`);
            }
        }

        initializeDbBtn.addEventListener('click', async () => {
            initializeDbBtn.disabled = true;
            initializeDbBtn.textContent = 'جارٍ التهيئة...';
            await populateFirestoreFromDefaults();
            await loadDataFromFirestore();
            renderAdminView(libraryData); // Use renderAdminView instead of renderAdminPanel directly
            initializeDbBtn.disabled = false;
            initializeDbBtn.textContent = 'تهيئة قاعدة البيانات بالكتب الافتراضية';
        });

        const loadDataFromFirestore = async () => {
            try {
                const querySnapshot = await db.collection("categories").orderBy("order").get();
                libraryData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                categoryNameMap = {};
                libraryData.forEach(cat => categoryNameMap[cat.categoryName] = cat.id);

                if (libraryData.length === 0) {
                    initializationSection.style.display = 'block';
                } else {
                    initializationSection.style.display = 'none';
                }
            } catch (error) {
                console.error("Error loading data from Firestore: ", error);
                manageBookList.innerHTML = `<p style="color:red;">حدث خطأ أثناء تحميل البيانات: ${error.message}</p>`;
            }
        };
        
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // Main rendering function for admin book/category list
        const renderAdminView = (dataToDisplay) => {
            manageBookList.innerHTML = '';
            
            // Populate category dropdowns for add/edit forms
            const addBookCategorySelect = document.getElementById('book-category');
            const editBookCategorySelect = document.getElementById('edit-book-category-select');
            addBookCategorySelect.innerHTML = '';
            editBookCategorySelect.innerHTML = '';

            libraryData.forEach(catDoc => { // Always populate dropdowns with ALL categories from libraryData
                const option = document.createElement('option');
                option.value = catDoc.categoryName; // Use name for display/value
                option.textContent = catDoc.categoryName;
                option.dataset.categoryId = catDoc.id; // Store Firestore ID here
                
                addBookCategorySelect.appendChild(option.cloneNode(true));
                editBookCategorySelect.appendChild(option.cloneNode(true));
            });

            if (dataToDisplay.length === 0) {
                 manageBookList.innerHTML = '<p>لا توجد أقسام أو كتب تطابق بحثك (أو المكتبة فارغة).</p>';
                 return;
            }

            dataToDisplay.forEach((categoryDoc) => {
                const detailsElement = document.createElement('details');
                detailsElement.className = 'category-manage-section';
                if (categoryDoc.isSearchResult && categoryDoc.books.length > 0) {
                     detailsElement.open = true; // Open if it's a search result with books
                }

                const summaryElement = document.createElement('summary');
                summaryElement.textContent = categoryDoc.categoryName;
                detailsElement.appendChild(summaryElement);

                const booksListingDiv = document.createElement('div');
                booksListingDiv.className = 'books-listing-admin';

                if (categoryDoc.books && categoryDoc.books.length > 0) {
                     categoryDoc.books.forEach((book) => { // bookIndex is implicit if using forEach on filtered data
                        const bookItem = document.createElement('div');
                        bookItem.className = 'book-list-item';
                        // If it's a search result, book.originalIndex refers to its position in the *original* categoryDoc.books
                        // Otherwise, for full listing, the map index would be its direct index
                        const bookIndexForAction = book.hasOwnProperty('originalIndex') ? book.originalIndex : categoryDoc.books.indexOf(book);

                        bookItem.innerHTML = `
                            <div class="book-details">
                                <div class="title">${book.title}</div>
                                <div class="author">${book.author}</div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary edit-btn" data-category-id="${categoryDoc.id}" data-book-index="${bookIndexForAction}">تعديل</button>
                                <button class="btn btn-danger delete-btn" data-category-id="${categoryDoc.id}" data-book-index="${bookIndexForAction}">حذف</button>
                            </div>
                        `;
                        booksListingDiv.appendChild(bookItem);
                    });
                } else {
                    booksListingDiv.innerHTML += '<p>لا توجد كتب في هذا القسم.</p>';
                }
                detailsElement.appendChild(booksListingDiv);
                manageBookList.appendChild(detailsElement);
            });

            document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', handleDelete));
            document.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', handleEdit));
        };
        
        addCategoryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const categoryNameInput = document.getElementById('new-category-name');
            const newCategoryName = categoryNameInput.value.trim();
            if (!newCategoryName) {
                alert("الرجاء إدخال اسم للقسم.");
                return;
            }

            // Check if category name already exists
            if (libraryData.some(cat => cat.categoryName.toLowerCase() === newCategoryName.toLowerCase())) {
                alert("هذا القسم موجود بالفعل.");
                return;
            }

            try {
                const newOrder = libraryData.length > 0 ? Math.max(...libraryData.map(c => c.order)) + 1 : 0;
                await db.collection("categories").add({
                    categoryName: newCategoryName,
                    order: newOrder,
                    books: []
                });
                categoryNameInput.value = '';
                alert("تمت إضافة القسم بنجاح!");
                await loadAndRenderAdminPanel(); // Reload and re-render everything
            } catch (error) {
                console.error("Error adding category:", error);
                alert("خطأ في إضافة القسم: " + error.message);
            }
        });


        const handleDelete = async (e) => {
            const { categoryId, bookIndex } = e.target.dataset;
            const numericBookIndex = parseInt(bookIndex, 10);
            const categoryDoc = libraryData.find(cat => cat.id === categoryId);
            if (!categoryDoc || numericBookIndex < 0 || numericBookIndex >= categoryDoc.books.length) {
                 console.error("Invalid category or book index for delete", categoryId, numericBookIndex, categoryDoc);
                 alert("خطأ: بيانات الكتاب غير صالحة للحذف.");
                 return;
            }

            const bookTitle = categoryDoc.books[numericBookIndex].title;
            if (confirm(`هل أنت متأكد من حذف: "${bookTitle}"؟`)) {
                try {
                    const updatedBooks = categoryDoc.books.filter((_, idx) => idx !== numericBookIndex);
                    await db.collection("categories").doc(categoryId).update({ books: updatedBooks });
                    
                    categoryDoc.books = updatedBooks;
                    renderAdminView(libraryData); // Re-render with current full data or filtered data
                    handleAdminSearch(); // Apply current search term again
                    alert('تم حذف الكتاب بنجاح.');
                } catch (error) {
                    console.error("Error deleting book: ", error);
                    alert(`خطأ في حذف الكتاب: ${error.message}`);
                }
            }
        };

        const handleEdit = (e) => {
            const { categoryId, bookIndex } = e.target.dataset;
            const numericBookIndex = parseInt(bookIndex, 10);
            const categoryDoc = libraryData.find(cat => cat.id === categoryId);
             if (!categoryDoc || numericBookIndex < 0 || numericBookIndex >= categoryDoc.books.length) {
                 console.error("Invalid category or book index for edit", categoryId, numericBookIndex, categoryDoc);
                 alert("خطأ: بيانات الكتاب غير صالحة للتعديل.");
                 return;
             }
            const book = categoryDoc.books[numericBookIndex];

            document.getElementById('edit-book-original-category-id').value = categoryId;
            document.getElementById('edit-book-index').value = numericBookIndex; // Store the original index
            document.getElementById('edit-book-title').value = book.title;
            document.getElementById('edit-book-author').value = book.author;
            document.getElementById('edit-book-edition').value = book.edition;
            document.getElementById('edit-book-volumes').value = book.volumes;
            document.getElementById('edit-book-description').value = book.description || '';
            
            const editCategoryDropdown = document.getElementById('edit-book-category-select');
            Array.from(editCategoryDropdown.options).forEach(opt => {
                opt.selected = opt.dataset.categoryId === categoryId;
            });

            const imagePreview = document.getElementById('image-preview');
            imagePreview.src = book.image || '';
            imagePreview.style.display = book.image ? 'block' : 'none';
            document.getElementById('edit-book-image').value = '';
            
            editModalOverlay.style.display = 'flex';
        };

        closeModalBtn.addEventListener('click', () => editModalOverlay.style.display = 'none');
        editModalOverlay.addEventListener('click', (e) => {
            if (e.target === editModalOverlay) editModalOverlay.style.display = 'none';
        });

        addBookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const imageFile = document.getElementById('book-image').files[0];
            let imageBase64 = '';
            if (imageFile) imageBase64 = await toBase64(imageFile);

            const newBook = {
                title: document.getElementById('book-title').value.trim(),
                author: document.getElementById('book-author').value.trim(),
                edition: document.getElementById('book-edition').value.trim(),
                volumes: document.getElementById('book-volumes').value.trim(),
                description: document.getElementById('book-description').value.trim(),
                image: imageBase64
            };
            
            const selectedOption = categorySelectForBookAdd.options[categorySelectForBookAdd.selectedIndex];
            const categoryId = selectedOption.dataset.categoryId; // Get ID from data attribute

            const categoryDoc = libraryData.find(cat => cat.id === categoryId);
            if(categoryDoc) {
                try {
                    const updatedBooks = [...categoryDoc.books, newBook];
                    updatedBooks.sort((a, b) => a.title.localeCompare(b.title, 'ar'));
                    
                    await db.collection("categories").doc(categoryId).update({ books: updatedBooks });
                    
                    categoryDoc.books = updatedBooks;
                    renderAdminView(libraryData); // Re-render full list initially
                    handleAdminSearch(); // Re-apply search filter
                    addBookForm.reset();
                    document.getElementById('book-image').value = '';
                    alert('تمت إضافة الكتاب بنجاح!');
                } catch (error) {
                    console.error("Error adding book: ", error);
                    alert(`خطأ في إضافة الكتاب: ${error.message}`);
                }
            } else {
                alert("الرجاء تحديد قسم صحيح.");
            }
        });
        
        editBookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const originalCategoryId = document.getElementById('edit-book-original-category-id').value;
            const bookIndex = parseInt(document.getElementById('edit-book-index').value, 10);
            
            const originalCategoryDoc = libraryData.find(cat => cat.id === originalCategoryId);
             if (!originalCategoryDoc || bookIndex < 0 || bookIndex >= originalCategoryDoc.books.length) {
                alert("خطأ: لم يتم العثور على بيانات الكتاب الأصلي."); return;
            }

            const imageFile = document.getElementById('edit-book-image').files[0];
            let imageBase64 = originalCategoryDoc.books[bookIndex].image; 
            if (imageFile) imageBase64 = await toBase64(imageFile);

            const updatedBookData = {
                title: document.getElementById('edit-book-title').value.trim(),
                author: document.getElementById('edit-book-author').value.trim(),
                edition: document.getElementById('edit-book-edition').value.trim(),
                volumes: document.getElementById('edit-book-volumes').value.trim(),
                description: document.getElementById('edit-book-description').value.trim(),
                image: imageBase64
            };

            const newCategorySelect = document.getElementById('edit-book-category-select');
            const newSelectedOption = newCategorySelect.options[newCategorySelect.selectedIndex];
            const newCategoryId = newSelectedOption.dataset.categoryId;

            try {
                if (originalCategoryId === newCategoryId) {
                    const updatedBooks = [...originalCategoryDoc.books];
                    updatedBooks[bookIndex] = updatedBookData;
                    updatedBooks.sort((a, b) => a.title.localeCompare(b.title, 'ar'));
                    await db.collection("categories").doc(originalCategoryId).update({ books: updatedBooks });
                    originalCategoryDoc.books = updatedBooks;
                } else {
                    // Remove from old category's books array
                    const oldCategoryBooks = originalCategoryDoc.books.filter((_, idx) => idx !== bookIndex);
                    await db.collection("categories").doc(originalCategoryId).update({ books: oldCategoryBooks });
                    originalCategoryDoc.books = oldCategoryBooks;

                    // Add to new category's books array
                    const newCategoryDoc = libraryData.find(cat => cat.id === newCategoryId);
                     if (!newCategoryDoc) { alert("خطأ: لم يتم العثور على القسم الجديد."); return; }
                    const newCategoryBooks = [...newCategoryDoc.books, updatedBookData];
                    newCategoryBooks.sort((a, b) => a.title.localeCompare(b.title, 'ar'));
                    await db.collection("categories").doc(newCategoryId).update({ books: newCategoryBooks });
                    newCategoryDoc.books = newCategoryBooks;
                }
                
                renderAdminView(libraryData);
                handleAdminSearch(); // Re-apply search filter
                editModalOverlay.style.display = 'none';
                alert('تم تحديث الكتاب بنجاح!');

            } catch (error) {
                console.error("Error updating book: ", error);
                alert(`خطأ في تحديث الكتاب: ${error.message}`);
            }
        });
        
        const handleAdminSearch = () => {
            const searchTerm = normalizeText(adminSearchInput.value);
            if (!searchTerm) {
                renderAdminView(libraryData); // Render all if search is empty
                return;
            }

            const filteredResults = [];
            libraryData.forEach(categoryDoc => {
                const matchingBooks = categoryDoc.books
                    .map((book, originalIndex) => ({ ...book, originalIndex })) // Add original index
                    .filter(book =>
                        normalizeText(book.title).includes(searchTerm) ||
                        normalizeText(book.author).includes(searchTerm)
                    );

                if (matchingBooks.length > 0) {
                    filteredResults.push({
                        ...categoryDoc,
                        books: matchingBooks,
                        isSearchResult: true 
                    });
                }
            });
            renderAdminView(filteredResults);
        };
        adminSearchInput.addEventListener('input', handleAdminSearch);


        const loadAndRenderAdminPanel = async () => {
            manageBookList.innerHTML = '<p>جارٍ تحميل الأقسام والكتب...</p>';
            await loadDataFromFirestore();
            renderAdminView(libraryData); // Initial render with all data
        };

    });
    </script>
</body>
</html>
